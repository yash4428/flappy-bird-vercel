<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flappy Bird</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      }
      /* //green - #d6fa61   pink  - #ff9cb3   blue - #85c8ff */
      body {
        min-height: 100vh;
        background: linear-gradient(135deg, #1d1d24 0%, #12121c 100%);
        color: white;
        font-family: Arial, sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      .btn {
        padding: 12px 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: medium;
        font-weight: 600;
      }
     .btn-primary {
  background: linear-gradient(90deg, #85c8ff, #d6fa61);
  color: black;
  transition: transform 0.2s ease, opacity 0.2s ease;
}

/* Hover effect */
.btn-primary:hover {
  opacity: 0.8;
}

/* Optional: Active (click) effect */
.btn-primary:active {
  transform: translateY(0);
  opacity: 0.8;
}

      .btn-secondary {
        background: #85c8ff;
        color: black;
      }
      .btn-secondary:hover {
        background: #85c8ff;
      }

.game-container {
  position: relative;
  width: 70vw;
  margin-left: 250px;
  height: 80vh;
  max-width: 1000px;
  max-height: 750px;
  border: 1px solid rgb(214, 250, 97,0.5);
  border-radius: 20px;
  overflow: hidden;
  background: #1b2337;
  box-shadow: 0 0 15px #3f452b, 
              0 0 15px #d6fa61, 
              0 0 15px #d6fa61;
}

      #videoElement {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scaleX(-1);
      }
      #gameCanvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }

      .handCursor {
        position: absolute;
        width: 44px;
        height: 44px;
        background: rgba(169, 250, 48, 0.4);
        border-radius: 50%;
        border: 3px solid rgba(150, 255, 102, 0.8);
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.4),
          inset 0 0 20px rgba(16, 185, 129, 0.2);
        pointer-events: none;
        z-index: 30;
        transition: transform 100ms, opacity 150ms;
        opacity: 0;
        transform: translate(-50%, -50%);
      }

      .hud {
        position: fixed;
        top: 55px;
        left: 20px;
        z-index: 50;
        background: rgba(17, 24, 39, 0.9);
        backdrop-filter: blur(12px);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid #ff9cb3;
        box-shadow: 0 0 30px rgba(249, 180, 232, 0.6);
        min-width: 260px;
        justify-content: center;
        align-items: center;
      }
      .hud .grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 25px;
        text-align: center;
      }
      .hud .big {
        font-size: 28px;
        font-weight: bold;
      }
      .hud .label {
        font-size: 15px;
        color: #e1e4ea;
      }

      .hand-panel {
        position: fixed;
        top: 200px;
        left: 20px;
        z-index: 50;
        background: rgba(17, 24, 39, 0.95);
        backdrop-filter: blur(12px);
        border-radius: 16px;
        padding: 24px 32px;
        border: 1px solid rgb(133, 200, 255,0.5);
        box-shadow: 0 0 20px rgb(133, 200, 255,0.5);
        min-width: 260px;
        text-align: center;
      }

      .overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.92);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 60;
      }
      .overlay .box {
        background: #111827;
        border-radius: 16px;
        padding: 40px;
        border: 2px solid rgb(214, 250, 97,0.3);
        text-align: center;
        max-width: 600px;
         animation: glowPulse 2s infinite alternate;
      }
    
      @keyframes glowPulse {
  from {
    box-shadow: 0 0 10px #596923, 0 0 20px #65713d, 0 0 30px #161345;
  }
  to {
    box-shadow: 0 0 20px #424c21, 0 0 40px #2b350a, 0 0 60px #141143;
  }
}
    </style>
  </head>
  <body>
    <!-- HUD -->
    <div class="hud">
      
      <div class="grid">
        <div>
          <div id="score" class="big" style="color: #d6fa61">0</div>
          <div class="label">Score</div>
        </div>
        <div>
          <div id="lives" class="big" style="color: #ff9cb3">3</div>
          <div class="label">Lives</div>
        </div>
        <div>
          <div id="level" class="big" style="color: #85c8ff">1</div>
          <div class="label">Level</div>
        </div>
      </div>
      <div
        style="
          margin-top: 12px;
          text-align: center;
          font-size: 14px;
          color: #9ca3af;
        "
      >
        Time: <span id="gameTime">0</span>s
      </div>
    </div>

    <!-- Hand Indicator -->
    <div class="hand-panel">
      <div
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 12px;
        "
      >
        <div
          id="handStatus"
          style="
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ef4444;
          "
        ></div>
        <div
          id="handText"
          style="font-size: 16px; color: #fca5a5; font-weight: 600"
        >
          No Hand Detected
        </div>
      </div>
    </div>

    <!-- Game -->
    <div class="game-container">
      <video id="videoElement" autoplay muted playsinline></video>
      <canvas id="gameCanvas"></canvas>
      <div id="handCursor1" class="handCursor"></div>
      <div id="handCursor2" class="handCursor"></div>
    </div>
<!-- Game Over --> 
<div
  id="gameOverScreen"
  style="
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 60;
  "
>
  <div
    style="
      background: #111827;
      border-radius: 16px;
      padding: 40px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      border: 2px solid rgba(214, 250, 97, 0.3);
      box-shadow: 0 0 25px rgba(214, 250, 97, 0.5);
    "
  >
    <h2
      id="gameOverTitle"
      style="
        font-size: 32px;
        font-weight: bold;
        color: #3b82f6;
        margin-bottom: 30px;
        animation: glowPulse 2s infinite alternate;
      "
    >
      Game Over!
    </h2>

    <div
      id="gameOverStats"
      style="
        color: #d1d5db;
        margin-bottom: 30px;
        font-size: 16px;
        line-height: 1.6;
      "
    >
      <p>Score: 6</p>
      <p>Level: 2</p>
      <p>Time: 21s</p>
    </div>

    <button
      onclick="location.reload()"
      style="
        display: block;
        width: 100%;
        margin-bottom: 16px;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        font-size: 16px;
        color: #000;
        cursor: pointer;
        background: linear-gradient(to right, #85c8ff, #d6fa61);
        transition: opacity 0.3s;
      "
      onmouseover="this.style.opacity=0.85"
      onmouseout="this.style.opacity=1"
    >
      Play Again
    </button>

    <button
      onclick="window.location.href = '.'"
      style="
        display: block;
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        font-size: 16px;
        color: #000;
        cursor: pointer;
        background: #85c8ff;
        transition: opacity 0.3s;
      "
      onmouseover="this.style.opacity=0.85"
      onmouseout="this.style.opacity=1"
    >
      ← Back
    </button>
  </div>
</div>

<!-- Glow animation -->
<style>
@keyframes glowPulse {
  from {
    text-shadow: 0 0 8px rgba(59, 130, 246, 0.7),
                 0 0 16px rgba(59, 130, 246, 0.6);
  }
  to {
    text-shadow: 0 0 16px rgba(59, 130, 246, 1),
                 0 0 32px rgba(59, 130, 246, 0.8);
  }
}
</style>


    <!-- Instructions -->
    <div id="instructionsScreen" class="overlay" style="display: flex">
      <div class="box">
        <h2
          style="
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 20px;
            color: white;
          "
        >
          Flappy Bird
        </h2>
        <p style="color: #d1d5db; margin-bottom: 12px">
          Raise your hand to make the bird go up, lower to go down.<br />
          <br />
          Stay above waist level to start. Avoid the pipes. <h3 style="margin-bottom: 24px;">Good luck!</h3> 
        </p>
        <button
          onclick="startGame()"
          class="btn btn-primary"
          style="margin-bottom: 16px; width: 100%"
        >
          Start
        </button>
       
      </div>
    </div>

     <!-- MediaPipe -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

  <script>
    // --- Game state ---
    let gameRunning=false, gamePaused=false, score=0, lives=3, level=1, gameTime=0;
    let gameStarted=false, gameTimer=null;

    // NEW: one-time speed boost flag when score >= 10
    let speedBoosted = false;

    // --- Elements / context ---
    const canvas=document.getElementById('gameCanvas');
    const ctx=canvas.getContext('2d');
    const gameContainer=document.querySelector('.game-container');
    const handCursor1=document.getElementById('handCursor1');
    const handCursor2=document.getElementById('handCursor2');
    const videoElement=document.getElementById('videoElement');

    function resizeCanvas(){
      const r=gameContainer.getBoundingClientRect();
      canvas.width=r.width; canvas.height=r.height;
    }
    window.addEventListener('resize',resizeCanvas);

    // --- Bird & Pipes ---
    const bird = { x: 120, y: 200, radius: 28 };
    let targetY = null;

    let pipes = [];
    let pipeSpawnCounter = 0;

    // RANDOMIZED & FASTER SETTINGS

    let baseSpawn = 80,  minSpawn = 50;
    let baseSpeed = 1;//columns speed
    let pipeSpeed = baseSpeed;

    const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));

    function spawnPipe(){
      const gapJitter = (Math.random()*40 - 20); // ±20px
      const gap = clamp(baseGap - level*8 + gapJitter, minGap, 260);

      const width = Math.floor(60 + Math.random()*35); // 60–95

      const minTop = 50;
      const maxTop = canvas.height - gap - 50;
      const top = Math.random()*(maxTop-minTop) + minTop;

      const speedJitter = 1 + (Math.random()*0.18 - 0.09); // ±9%

      pipes.push({
        x: canvas.width,
        width,
        top,
        bottom: top + gap,
        scored: false,
        speedMul: speedJitter
      });
    }

    function updatePipes(){
      pipeSpawnCounter++;
      const spawnEvery = Math.max(minSpawn, (baseSpawn - level*3) + Math.floor(Math.random()*9 - 4));
      if(pipeSpawnCounter >= spawnEvery){
        pipeSpawnCounter = 0;
        spawnPipe();
      }
      pipes.forEach(p => p.x -= pipeSpeed * p.speedMul);
      pipes = pipes.filter(p => p.x + p.width > 0);
    }

    // Draw camera feed as background (mirrored)
    function drawCameraBackground(){
      if(videoElement.readyState >= 2) {
        ctx.save();
        ctx.scale(-1, 1);
        ctx.drawImage(videoElement, -canvas.width, 0, canvas.width, canvas.height);
        ctx.restore();
        ctx.fillStyle = 'rgba(0,0,0,0.12)';
        ctx.fillRect(0,0,canvas.width,canvas.height);
      } else {
        const g = ctx.createLinearGradient(0,0,0,canvas.height);
        g.addColorStop(0,'#2b2f55'); g.addColorStop(1,'#1c203a');
        ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);
      }
    }

    function drawPipes(){
      pipes.forEach(p=>{
        ctx.fillStyle = 'rgba(0,0,0,0.25)';
        ctx.fillRect(p.x+3,0,p.width,p.top);
        ctx.fillRect(p.x+3,p.bottom,p.width,canvas.height-p.bottom);

        const pg = ctx.createLinearGradient(p.x,0,p.x+p.width,0);
        pg.addColorStop(0,'#22c55e'); pg.addColorStop(0.5,'#16a34a'); pg.addColorStop(1,'#15803d');
        ctx.fillStyle = pg;
        ctx.fillRect(p.x,0,p.width,p.top);
        ctx.fillRect(p.x,p.bottom,p.width,canvas.height-p.bottom);

        ctx.fillStyle = '#15803d';
        ctx.fillRect(p.x-3, p.top-8, p.width+6, 8);
        ctx.fillRect(p.x-3, p.bottom, p.width+6, 8);

        ctx.fillStyle = '#34d399';
        ctx.fillRect(p.x,0,4,p.top);
        ctx.fillRect(p.x,p.bottom,4,canvas.height-p.bottom);
      });
    }

    function drawBird(){
      ctx.shadowColor='#fbbf24'; ctx.shadowBlur=18;
      const grad = ctx.createRadialGradient(bird.x,bird.y,0,bird.x,bird.y,bird.radius);
      grad.addColorStop(0,'#fde047');
      grad.addColorStop(0.7,'#fbbf24');
      grad.addColorStop(1,'#f59e0b');
      ctx.fillStyle=grad;
      ctx.beginPath(); ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI*2); ctx.fill();
      ctx.shadowBlur=0;

      ctx.fillStyle='#000';
      ctx.beginPath(); ctx.arc(bird.x+7, bird.y-4, 4, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle='#fff';
      ctx.beginPath(); ctx.arc(bird.x+8, bird.y-5, 1.5, 0, Math.PI*2); ctx.fill();

      ctx.fillStyle='#f97316';
      ctx.beginPath();
      ctx.moveTo(bird.x + bird.radius - 2, bird.y);
      ctx.lineTo(bird.x + bird.radius + 12, bird.y - 3);
      ctx.lineTo(bird.x + bird.radius + 12, bird.y + 3);
      ctx.closePath(); ctx.fill();
    }

    // Boost speed at score 10, and keep leveling after that
    function updateScoreAndLevel(){
      pipes.forEach(p=>{
        if(!p.scored && p.x + p.width < bird.x){
          p.scored = true;
          score++;
          document.getElementById('score').textContent = score;

          // One-time boost when reaching 10
          if(score >= 10 && !speedBoosted){
            speedBoosted = true;
            baseSpeed = Math.min(16, baseSpeed + 2.0);  // bump base speed
            pipeSpeed = Math.min(16, pipeSpeed + 2.0);  // immediate effect
            baseSpawn = Math.max(20, baseSpawn - 6);    // spawn a bit more often
            minGap   = Math.max(120, minGap - 10);      // slightly tighter
          }

          // level scales every 5 points as before
          const newLevel = Math.floor(score/5) + 1;
          if(newLevel !== level){
            level = newLevel;
            document.getElementById('level').textContent = level;
            pipeSpeed = Math.min(16.0, baseSpeed + (level-1)*0.7);
          }
        }
      });
    }

    function checkCollision(){
      for(const p of pipes){
        if(bird.x + bird.radius > p.x && bird.x - bird.radius < p.x + p.width){
          if(bird.y - bird.radius < p.top || bird.y + bird.radius > p.bottom){
            lives--;
            document.getElementById('lives').textContent = lives;
            if(lives <= 0){
              endGame();
            } else {
              pipes = pipes.filter(pp => pp.x + pp.width > bird.x + 120);
            }
            return;
          }
        }
      }
      if(bird.y < bird.radius) bird.y = bird.radius;
      if(bird.y > canvas.height - bird.radius){
        lives--;
        document.getElementById('lives').textContent = lives;
        if(lives <= 0){ endGame(); }
        else bird.y = canvas.height - bird.radius;
      }
    }

    // --- MediaPipe Hands ---
    let handsData = [];
    function initMediaPipe(){
      const hands = new Hands({
        locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
      });
      hands.setOptions({
        maxNumHands: 2,
        modelComplexity: 1,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
      });
      hands.onResults(onResults);

      const camera = new Camera(videoElement, {
        onFrame: async () => {
          if(videoElement.videoWidth>0){
            await hands.send({ image: videoElement });
          }
        },
        width: 1280,
        height: 720
      });
      camera.start();
    }

    function onResults(res){
      handsData = [];
      const hs=document.getElementById('handStatus'); 
      const ht=document.getElementById('handText');

      if(res.multiHandLandmarks && res.multiHandLandmarks.length>0){
        const rect=gameContainer.getBoundingClientRect();

        res.multiHandLandmarks.forEach((lm,i)=>{
          const wrist = lm[0];
          const handX = (1 - wrist.x) * rect.width; // mirrored
          const handY = wrist.y * rect.height;

          handsData.push({x:handX, y:handY});

          const cursor = i===0 ? handCursor1 : handCursor2;
          cursor.style.left = handX+'px';
          cursor.style.top = handY+'px';
          cursor.style.opacity='0.8';
        });

        if(gameStarted){
          const aboveWaist = handsData.some(h=>h.y < canvas.height*0.66);
          if(!aboveWaist){
            hs.style.background='#f59e0b'; 
            ht.textContent='Move hand above waist';
            gameRunning = false;
            return;
          } else {
            hs.style.background='#10b981'; 
            ht.textContent='Control the bird';
            if(!gameRunning){
              gameRunning = true;
              gameLoop();
            }
          }
        } else {
          hs.style.background='#10b981'; ht.textContent='Hand(s) Detected';
        }

        const primary = handsData[0] || handsData[1];
        if(primary){
          targetY = primary.y;
        }
      } else {
        handCursor1.style.opacity='0';
        handCursor2.style.opacity='0';
        document.getElementById('handStatus').style.background='#ef4444';
        document.getElementById('handText').textContent='No Hand Detected';
      }
    }

    // --- Main loop ---
    function update(){
      if(targetY !== null){
        const clamped = Math.max(bird.radius, Math.min(canvas.height - bird.radius, targetY));
        bird.y = clamped * 0.6 + bird.y * 0.4;
      }

      pipeSpeed = Math.min(16.0, baseSpeed + (level-1)*0.7);

      updatePipes();
      updateScoreAndLevel();
      checkCollision();
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawCameraBackground();
      drawPipes();
      drawBird();
    }

    function gameLoop(){
      if(!gameRunning || gamePaused) return;
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    // --- UI control ---
    function updateHUD(){
      document.getElementById('score').textContent=score;
      document.getElementById('lives').textContent=lives;
      document.getElementById('level').textContent=level;
    }

    function startGame(){
      // hide BOTH overlays in case we're coming from Game Over or first screen
      document.getElementById('instructionsScreen').style.display='none';
      document.getElementById('gameOverScreen').style.display='none';

      // full reset
      gameStarted = true;
      gameRunning = false;      // waits for above-waist to start loop
      gamePaused  = false;
      score=0; lives=3; level=1; gameTime=0;
      pipes=[]; pipeSpawnCounter=0; targetY=null;
      speedBoosted = false;     // NEW: reset the one-time boost
      baseGap = 190; minGap = 150;
      baseSpawn = 48; baseSpeed = 5.5; pipeSpeed = baseSpeed;

      updateHUD();

      if(gameTimer) clearInterval(gameTimer);
      gameTimer=setInterval(()=>{
        if(gameRunning && !gamePaused){
          gameTime++;
          document.getElementById('gameTime').textContent=gameTime;
        }
      },1000);
    }

    function endGame(){
      gameRunning=false;
      document.getElementById('gameOverTitle').textContent='Game Over!';
      document.getElementById('gameOverStats').innerHTML =
        `<div>Score: ${score}</div><div>Level: ${level}</div><div>Time: ${gameTime}s</div>`;
      document.getElementById('gameOverScreen').style.display='flex';
    }

    function goBack(){ alert('Back to menu'); }

    // --- Boot ---
    window.addEventListener('load',()=>{
      resizeCanvas();
      initMediaPipe();
      const ro = new ResizeObserver(()=>resizeCanvas());
      ro.observe(gameContainer);
    });

    // Optional: Space to pause/resume
    document.addEventListener('keydown', (e)=>{
      if(e.code==='Space'){
        gamePaused = !gamePaused;
        if(!gamePaused && gameRunning) gameLoop();
      }
    });
  </script>
</body>
</html>
